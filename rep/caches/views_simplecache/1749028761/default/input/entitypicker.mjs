import 'jquery';import 'jquery-ui';import '../jquery.ui.autocomplete.html.js';import elgg from 'elgg';import Ajax from 'elgg/Ajax';function EntityPicker(wrapper){this.$wrapper=$(wrapper);this.$input=$('.elgg-input-entity-picker',wrapper);this.$ul=$('.elgg-entity-picker-list',wrapper);var EntityPicker=this,data=this.$wrapper.data();this.name=data.name||'entities';this.matchOn=data.matchOn||'entities';this.handler=data.handler||'livesearch';this.limit=data.limit||0;this.minLength=data.minLength||2;this.isSealed=!1;this.$input.autocomplete({source:function(request,response){var Autocomplete=this;if(EntityPicker.isSealed){return}
var ajax=new Ajax();ajax.path(EntityPicker.handler,{data:{term:Autocomplete.term,match_on:EntityPicker.getSearchType(),name:EntityPicker.name},method:'GET',success:function(data){response(data)}})},minLength:EntityPicker.minLength,html:'html',select:function(event,ui){EntityPicker.addEntity(event,ui.item.guid,ui.item.html)},messages:{noResults:'',results:function(){}}});this.$wrapper.on('click','.elgg-autocomplete-item-remove',function(event){EntityPicker.removeEntity(event)});this.enforceLimit()}
EntityPicker.prototype={addEntity:function(event,guid,html){if(event.isDefaultPrevented()){return}
if(!$('li[data-guid="'+guid+'"]',this.$ul).length){this.$ul.append(html)}
this.$input.val('');this.enforceLimit();event.preventDefault()},removeEntity:function(event){$(event.target).closest('.elgg-entity-picker-list > li').remove();this.enforceLimit();event.preventDefault()},enforceLimit:function(){if(this.limit){if($('li[data-guid]',this.$ul).length>=this.limit){if(!this.isSealed){this.seal()}}else{if(this.isSealed){this.unseal()}}}},seal:function(){this.$input.prop('disabled',!0);this.$wrapper.addClass('elgg-state-disabled');this.isSealed=!0},unseal:function(){this.$input.prop('disabled',!1);this.$wrapper.removeClass('elgg-state-disabled');this.isSealed=!1},getSearchType:function(){if(this.$wrapper.has('[type="checkbox"][name="match_on"]:checked').length){return $('[type="checkbox"][name=match_on]:checked',this.$wrapper).val()}
return this.matchOn}};EntityPicker.setup=function(selector){$(selector).each(function(){if(!$(this).data('initialized')){new EntityPicker(this);$(this).data('initialized',1)}})};export default EntityPicker